import{r as t,d as s,h as i,c as h}from"./p-f24f087d.js";import{c as r,d as e,l as n,e as a,f as o,s as l,m as c}from"./p-556b5a22.js";var u;!function(t){t.linear="line",t.natural="curve",t.step="step"}(u||(u={}));const f=class{constructor(i){t(this,i),this.container=null,this.lineDef=r().x(t=>this.xScale(t.x)).y(t=>this.yScale(t.y)).curve(e),this.minMaxValues={maxX:0,maxY:0,xForMaxY:0,yForMaxX:0},this.path=null,this.svg=null,this.xScale=n(),this.yScale=n(),this.margin={bottom:0,left:0,right:0,top:0},this.curveType=u.step,this.data=[],this.height=200,this.transitionDuration=350,this.width=600,this.xLimit=0,this.yLimit=0,this.readychart=s(this,"readychart",7),this.updatechart=s(this,"updatechart",7),this.beforeUpdatechart=s(this,"beforeUpdatechart",7)}formatData(t){let s=t;if("string"==typeof t)try{s=JSON.parse(t)}catch(i){s=[],console.warn("Could not process data",i.message)}return s}setDataHandler(t){"string"==typeof this.data&&(this.data=this.formatData(t)),this.minMaxValues={maxX:this.xLimit,maxY:this.yLimit,xForMaxY:0,yForMaxX:0}}setXLimitHandler(t){this.minMaxValues.maxX=t}setYLimitHandler(t){this.minMaxValues.maxY=t}componentWillLoad(){"string"==typeof this.data&&(this.data=this.formatData(this.data))}componentDidLoad(){this.initChartRoot(),this.rebuildChartDefs(),this.drawChart(),setTimeout(()=>{this.readychart.emit(this)},this.transitionDuration)}componentDidUpdate(){this.beforeUpdatechart.emit(this),this.rebuildChartDefs(),this.drawChart(),setTimeout(()=>{this.updatechart.emit(this)},this.transitionDuration)}async getContainer(){return this.container}async getInstance(){return this}async getPath(){return this.path}async updateMargins(t){this.margin=Object.assign({},this.margin,...Object.keys(t).filter(s=>s in this.margin&&"number"==typeof t[s]).map(s=>({[s]:this.margin[s]+t[s]})))}drawChart(){const{left:t,top:s}=this.margin;if(!this.svg||!this.lineDef)return;if(this.svg.attr("viewBox",`0 0 ${this.width||600} ${this.height||300}`),this.container&&this.container.attr("transform",`translate(${t||0},${s||0})`),!this.data.length)return;const i=[{x:0,y:0},...this.data,{x:this.data[this.data.length-1].x,y:0}];this.path&&this.path.datum(i).transition().duration(this.transitionDuration).attr("d",this.lineDef.curve(this.getCurveFromType()))}getChartDimensions(){const{left:t,right:s,top:i,bottom:h}=this.margin;return{width:(this.width||600)-(t||0)-(s||0),height:(this.height||300)-(i||0)-(h||0)}}getCurveFromType(){return this.curveType===u.linear?a:this.curveType===u.natural?o:e}initChartRoot(){if(!this.hostEl||!this.hostEl)return;const t=this.hostEl.querySelector("svg");!this.svg&&t&&(this.svg=l(t)),this.svg&&!this.container&&(this.container=this.svg.append("g").attr("class","linechart-image-group").attr("transform","translate(0,0)"),this.path=this.container?this.container.append("path").classed("linechart-path",!0):null)}rebuildChartDefs(){const{width:t,height:s}=this.getChartDimensions();this.minMaxValues=this.data.reduce(({maxX:t,maxY:s,xForMaxY:i,yForMaxX:h},{x:r,y:e})=>({maxX:r>t&&r||t,maxY:e>s&&e||s,xForMaxY:e>s&&r||i,yForMaxX:r>t&&e||h}),Object.assign({},this.minMaxValues,{maxX:this.xLimit,maxY:this.yLimit}));const{maxX:i,maxY:h}=this.minMaxValues;this.xScale=n().domain([0,i]).range([0,t]),this.yScale=n().domain([0,Math.max(5,h)]).range([s,0]).clamp(!0),this.lineDef=r().x(t=>this.xScale(t.x)).y(t=>this.yScale(t.y)).curve(e)}render(){return i("div",{class:"chart-container"},i("div",{class:"svg-container"},i("svg",{class:`svg-content${this.data&&this.data.length?"":" no-data"}`,xmlns:"http://www.w3.org/2000/svg",viewBox:`0 0 ${this.width||600} ${this.height||300}`,preserveAspectRatio:"xMinYMin meet"})))}get hostEl(){return h(this)}static get watchers(){return{data:["setDataHandler"],xLimit:["setXLimitHandler"],yLimit:["setYLimitHandler"]}}static get style(){return":host,:root{--nanoshell-linechart-background-color:var(--ont-background-color,transparent);--nanoshell-linechart-fill:var(--ont-linechart-fill,#01738f);--nanoshell-linechart-fill-opacity:var(--ont-linechart-fill-opacity,0.8);--nanoshell-linechart-stroke:var(--ont-linechart-stroke,transparent);--nanoshell-linechart-stroke-width:var(--ont-linechart-stroke-width,0);--nanoshell-linechart-stroke-opacity:var(--ont-linechart-stroke-opacity,0.8)}.chart-container{display:-ms-flexbox;display:flex;-ms-flex-flow:row wrap;flex-flow:row wrap;-ms-flex:0 1 auto;flex:0 1 auto;-ms-flex-pack:center;justify-content:center;font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;margin:0 auto}.chart-container .svg-container{display:-ms-flexbox;display:flex;position:relative;width:100%;vertical-align:middle;-ms-flex:1;flex:1}.chart-container .svg-container .svg-content{display:-ms-flexbox;display:flex;top:0;left:0;-ms-flex:1;flex:1;-ms-flex-item-align:center;align-self:center;justify-self:center;overflow:hidden}.chart-container .svg-container .svg-content.no-data{display:none}.chart-container .svg-container .svg-content .bold-chart-label{font-size:11px;opacity:.8}.chart-container .svg-container .svg-content .linechart-path{fill:var(--nanoshell-linechart-fill);fill-opacity:var(--nanoshell-linechart-fill-opacity);stroke:var(--nanoshell-linechart-stroke);stroke-width:var(--nanoshell-linechart-stroke-width);stroke-opacity:var(--nanoshell-linechart-stroke-opacity)}"}};var m=Array.prototype.slice;function d(t){return t}var x=1,y=2,p=3,g=4,b=1e-6;function M(t){return"translate("+(t+.5)+",0)"}function $(t){return"translate(0,"+(t+.5)+")"}function w(t){return function(s){return+t(s)}}function L(t){var s=Math.max(0,t.bandwidth()-1)/2;return t.round()&&(s=Math.round(s)),function(i){return+t(i)+s}}function H(){return!this.__axis}function v(t,s){var i=[],h=null,r=null,e=6,n=6,a=3,o=t===x||t===g?-1:1,l=t===g||t===y?"x":"y",c=t===x||t===p?M:$;function u(u){var f=null==h?s.ticks?s.ticks.apply(s,i):s.domain():h,m=null==r?s.tickFormat?s.tickFormat.apply(s,i):d:r,M=Math.max(e,0)+a,$=s.range(),v=+$[0]+.5,X=+$[$.length-1]+.5,Y=(s.bandwidth?L:w)(s.copy()),E=u.selection?u.selection():u,k=E.selectAll(".domain").data([null]),T=E.selectAll(".tick").data(f,s).order(),C=T.exit(),_=T.enter().append("g").attr("class","tick"),D=T.select("line"),F=T.select("text");k=k.merge(k.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),T=T.merge(_),D=D.merge(_.append("line").attr("stroke","currentColor").attr(l+"2",o*e)),F=F.merge(_.append("text").attr("fill","currentColor").attr(l,o*M).attr("dy",t===x?"0em":t===p?"0.71em":"0.32em")),u!==E&&(k=k.transition(u),T=T.transition(u),D=D.transition(u),F=F.transition(u),C=C.transition(u).attr("opacity",b).attr("transform",(function(t){return isFinite(t=Y(t))?c(t):this.getAttribute("transform")})),_.attr("opacity",b).attr("transform",(function(t){var s=this.parentNode.__axis;return c(s&&isFinite(s=s(t))?s:Y(t))}))),C.remove(),k.attr("d",t===g||t==y?n?"M"+o*n+","+v+"H0.5V"+X+"H"+o*n:"M0.5,"+v+"V"+X:n?"M"+v+","+o*n+"V0.5H"+X+"V"+o*n:"M"+v+",0.5H"+X),T.attr("opacity",1).attr("transform",(function(t){return c(Y(t))})),D.attr(l+"2",o*e),F.attr(l,o*M).text(m),E.filter(H).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",t===y?"start":t===g?"end":"middle"),E.each((function(){this.__axis=Y}))}return u.scale=function(t){return arguments.length?(s=t,u):s},u.ticks=function(){return i=m.call(arguments),u},u.tickArguments=function(t){return arguments.length?(i=null==t?[]:m.call(t),u):i.slice()},u.tickValues=function(t){return arguments.length?(h=null==t?null:m.call(t),u):h&&h.slice()},u.tickFormat=function(t){return arguments.length?(r=t,u):r},u.tickSize=function(t){return arguments.length?(e=n=+t,u):e},u.tickSizeInner=function(t){return arguments.length?(e=+t,u):e},u.tickSizeOuter=function(t){return arguments.length?(n=+t,u):n},u.tickPadding=function(t){return arguments.length?(a=+t,u):a},u}const X=class{constructor(s){t(this,s),this.chart=null,this.maxText=null,this.minText=null,this.marginLeft=-5,this.marginBottom=-5,this.marginTop=0,this.unitsX="",this.unitsY=""}componentDidLoad(){const t=this.hostEl.querySelector("nanoshell-linechart");t&&(this.chart||t.getInstance().then(t=>{this.chart=t,this.initAxis()}))}componentWillUpdate(){this.updatechartHandler()}updatechartHandler(){this.yXisG.empty(),this.redrawAxis()}calculateMarginChange(){let t=0,s=0;return this.yXisG&&(t=Math.max(0,...this.yXisG.selectAll(".tick text").nodes().map(t=>t.getBBox().width+5)),s=Math.max(0,...this.axisG.selectAll(".axis-x-label").nodes().map(t=>t.getBBox().height+5))),{marginLeft:t,marginBottom:s}}async drawAxis(){this.drawXAxis(),this.drawYAxis();const{marginLeft:t,marginBottom:s}=this.calculateMarginChange(),i=this.marginTop;t===this.marginLeft&&s===this.marginBottom||await this.chart.updateMargins({bottom:s-this.marginBottom,left:t-this.marginLeft,top:5-i}),this.marginLeft=t,this.marginBottom=s,this.marginTop=i||5}drawXAxis(){if(!this.minText||!this.maxText)return;const{width:t,height:s}=this.chart.getChartDimensions(),{maxX:i}=this.chart.minMaxValues;this.axisG.attr("transform",`translate(0, ${s+20-5})`),this.minText.text(`0${this.unitsX}`),this.maxText.text(`${(this.chart.refLength||i||0).toLocaleString()}${this.unitsX}`).attr("transform",`translate(${t-5}, 0)`)}drawYAxis(){if(!this.yXisG)return;const t=this.chart.yScale,{height:s,width:i}=this.chart.getChartDimensions();var h;t.range([s,0]),this.yXisG.call((h=t,v(y,h)).ticks(s/(.25*s)||2,",.0r").tickSize(i).tickFormat(t=>`${t.toLocaleString()}${this.unitsY}`)).call(t=>{t.selectAll(".tick:not(:first-of-type) line").attr("stroke-dasharray","2,2"),t.selectAll(".tick text").attr("text-anchor","end").attr("x",-5).attr("dy",5),t.select(".domain").remove()})}async initAxis(){this.axisG=this.chart.container.append("g").classed("axis",!0),this.minText=this.axisG.append("text").classed("axis-x-label min bold-chart-label",!0).attr("style","text-anchor: left;").text(`0${this.unitsX}`).attr("transform","translate(5, 0)"),this.maxText=this.axisG.append("text").classed("axis-x-label max bold-chart-label",!0).attr("style","text-anchor: end;").attr("transform",`translate(${this.chart.width-5}, 0)`),this.yXisG=this.chart.container.append("g").attr("transform","translate(0, 0)").classed("y-axis",!0).classed("axis",!0),this.drawAxis()}redrawAxis(){this.drawAxis()}render(){return null}get hostEl(){return h(this)}static get style(){return":host{--nanoshell-linechart-axis-background-color:var(--ont-background-color,transparent)}.axis line,.axis path{fill:none;stroke:#000;stroke-opacity:.4;shape-rendering:geometricprecision}.tick text{font-size:11px;opacity:.8}"}},Y=class{constructor(s){t(this,s),this.chart=null,this.marginLeft=0,this.marginBottom=0,this.marginTop=0,this.labelX="",this.labelXLeft="",this.labelXRight="",this.labelY=""}componentDidLoad(){const t=this.hostEl.querySelector("nanoshell-linechart");t&&(this.chart||t.getInstance().then(t=>{this.chart=t,this.initLabels()}))}componentWillUpdate(){this.updatechartHandler()}updatechartHandler(){this.labelG.empty(),this.redrawLabels()}calculateMarginChange(){let t=0,s=0;const i=this.yLabelText.node(),h=this.xLabelText.node(),r=this.xLeftLabelText.node(),e=this.xRightLabelText.node(),n=this.labelY&&i?i.getBBox().height:0;let a=this.labelX&&h?h.getBBox().height:0;if((this.labelXLeft||this.labelXRight)&&!this.labelY){const t=e||e;a=t?t.getBBox().height:0}return this.labelG&&h&&r&&e&&i&&(t=n+5,s=a+5),{marginLeft:t,marginBottom:s,labelYHeight:n,labelXHeight:a}}async drawLabels(){if(!(this.labelG&&this.xLabelText&&this.xLeftLabelText&&this.xRightLabelText))return;const{left:t,top:s,bottom:i}=this.chart.margin,{width:h,height:r}=this.chart.getChartDimensions();this.labelG.attr("transform",`translate(${-t}, ${r})`),this.xLabelText.text(this.labelX),this.xLeftLabelText.text(this.labelXLeft),this.xRightLabelText.text(this.labelXRight),this.yLabelText.text(this.labelY);const{marginLeft:e,marginBottom:n,labelXHeight:a,labelYHeight:o}=this.calculateMarginChange();this.xLabelText.attr("transform",`translate(${t+h/2}, ${i-a<n?i-5:i-a})`),this.xLeftLabelText.attr("transform",`translate(${t+5}, ${i-5})`),this.xRightLabelText.attr("transform",`translate(${t+h-5}, ${i-5})`),this.yLabelText.attr("transform",`translate(${o}, ${-r/2}) rotate(-90)`);const l=this.marginTop;e===this.marginLeft&&n===this.marginBottom||await this.chart.updateMargins({bottom:n-this.marginBottom,left:e-this.marginLeft}),this.marginLeft=e,this.marginBottom=n,this.marginTop=l||s}async initLabels(){this.labelG=this.chart.container.append("g").classed("chart-label",!0),this.xLabelText=this.labelG.append("text").classed("bold-chart-label",!0).attr("style","text-anchor: middle;").text(this.labelX),this.yLabelText=this.labelG.append("text").classed("bold-chart-label",!0).attr("style","text-anchor: middle;").text(this.labelY),this.xLeftLabelText=this.labelG.append("text").classed("bold-chart-label",!0).attr("style","text-anchor: left;").text(this.labelXLeft),this.xRightLabelText=this.labelG.append("text").classed("bold-chart-label",!0).attr("style","text-anchor: end;").text(this.labelXRight),this.drawLabels()}redrawLabels(){this.drawLabels()}render(){return null}get hostEl(){return h(this)}static get style(){return":host{--nanoshell-linechart-label-background-color:var(--ont-background-color,transparent)}.bold-chart-label{font-size:11px;opacity:.8}"}},E=t=>Function(`"use strict"; return ${t};`)().bind(void 0),k=class{constructor(s){t(this,s),this.chart=null,this.formatX=t=>`${"number"==typeof t?t.toLocaleString():t}`,this.formatY=t=>`${"number"==typeof t?t.toLocaleString():t}`}formatXHandler(t){this.formatX="string"==typeof t?E(t):t,this.chart&&this.redrawTooltip()}formatYHandler(t){this.formatY="string"==typeof t?E(t):t,this.chart&&this.redrawTooltip()}componentDidLoad(){try{"string"==typeof this.formatX&&(this.formatX=E(this.formatX))}catch(s){console.warn("X label formatter is not a function")}try{"string"==typeof this.formatY&&(this.formatY=E(this.formatY))}catch(s){console.warn("Y label formatter is not a function")}const t=this.hostEl.querySelector("nanoshell-linechart");t&&(this.chart||t.getInstance().then(t=>{this.chart=t,this.initTooltip()}))}beforeUpdatechartHandler(){const{height:t}=this.chart.getChartDimensions();this.tooltipLabelYCircle.attr("r",5).attr("stroke-width",8).transition().duration(this.chart.transitionDuration-50).attr("r",0).attr("stroke-width",0),this.tooltipLine.attr("y1",0).transition().duration(this.chart.transitionDuration-50).attr("y1",t)}updatechartHandler(){this.tooltipG.empty(),this.redrawTooltip()}drawTooltip(){const{height:t}=this.chart.getChartDimensions();this.tooltipLabelYCircle.attr("r",0).attr("stroke-width",0).transition().duration(1e3).attr("r",5).attr("stroke-width",8),this.tooltipLine.attr("y2",t).attr("y1",t).transition().duration(this.chart.transitionDuration-50).attr("y1",0),this.tooltipG.transition().style("opacity",1)}async initTooltip(){await this.chart.updateMargins({top:20}),this.chart.svg.on("mousemove",()=>{this.setTooltip(c(this.chart.svg.node())[0])}).on("mouseleave",()=>this.tooltipG.transition().style("opacity",0)).on("mouseenter",()=>this.drawTooltip()),this.tooltipG=this.chart.container.append("g"),this.tooltipLine=this.tooltipG.append("line").attr("stroke-width",1).attr("stroke","black").attr("opacity",.3).attr("y1",0).attr("y2",0).attr("x1",0).attr("x2",0),this.tooltipLabelX=this.tooltipG.append("text").attr("fill","#444").classed("tooltip-label-top",!0),this.tooltipLabelY=this.tooltipG.append("text").attr("fill","#444").classed("tooltip-label-bottom",!0),this.tooltipLabelYCircle=this.tooltipG.append("circle").attr("fill","#2c6d68").attr("opacity",.8).attr("stroke","#53b8b1").attr("stroke-opacity",.2).attr("cx",0),this.drawTooltip()}redrawTooltip(){this.drawTooltip(),this.setMaxValue()}setMaxValue(){const{xForMaxY:t,yForMaxX:s}=this.chart.minMaxValues,{left:i}=this.chart.margin;let h=0;navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&(h=this.chart.width/this.hostEl.getBoundingClientRect().width*this.chart.hostEl.getBoundingClientRect().left-4);const r=Math.round(this.chart.xScale(t)),e=Math.round(this.chart.yScale(s));this.setTooltip(r+i+h,e)}setTooltip(t,s){const{width:i,height:h}=this.chart.getChartDimensions();let r=0;navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&(r=this.chart.width/this.hostEl.getBoundingClientRect().width*this.chart.hostEl.getBoundingClientRect().left-4);const{left:e}=this.chart.margin,n=t-e-r,a=Math.round(this.chart.xScale.invert(n));let o=s||0!==Math.round(n)?((t,s,i=.01)=>{let h=s.getTotalLength(),r=0,e=s.getPointAtLength((h+r)/2),n=0;for(;(t<e.x-i||t>e.x+i)&&(t<(e=s.getPointAtLength((h+r)/2)).x?h=(r+h)/2:r=(r+h)/2,!(50<(n+=1))););return e.y})(Math.floor(n),this.chart.path.node(),1e-4):h;if(n>=0&&n<=i){this.tooltipG.style("display","block"),this.tooltipG.attr("transform",`translate(${Math.floor(n)}, 0)`),this.tooltipLine.attr("y2",h),this.tooltipLabelX.text(this.formatX.call({},a.toLocaleString())),this.tooltipLabelY.text(this.formatY.call({},this.chart.yScale.invert(o).toFixed(0))),this.tooltipLabelYCircle.attr("cy",o),o=Math.min(o,h);const t=Math.max(this.tooltipLabelX.node().getBBoxZ&&this.tooltipLabelX.node().getBBoxZ().width||150,this.tooltipLabelY.node().getBBoxZ&&this.tooltipLabelY.node().getBBoxZ().width||150),s=n+t+10>i;t&&(s?(this.tooltipG.style("text-anchor","end"),this.tooltipLabelX.attr("transform",`translate(-10,${h-6})`),this.tooltipLabelY.attr("transform",`translate(-10,${Math.min(o-6,h-20)})`)):(this.tooltipG.style("text-anchor","start"),this.tooltipLabelX.attr("transform",`translate(10,${h-6})`),this.tooltipLabelY.attr("transform",`translate(10,${Math.min(o-6,h-20)})`)))}}render(){return null}get hostEl(){return h(this)}static get watchers(){return{formatX:["formatXHandler"],formatY:["formatYHandler"]}}static get style(){return":host{--nanoshell-linechart-tooltip-background-color:var(--ont-background-color,transparent)}.tooltip-label-bottom,.tooltip-label-top{font-size:10px;font-weight:700;color:#696969}"}};export{f as nanoshell_linechart,X as nanoshell_linechart_axis,Y as nanoshell_linechart_label,k as nanoshell_linechart_tooltip};