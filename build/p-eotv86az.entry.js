import{r as t,h as s,c as i}from"./p-f24f087d.js";import{C as h}from"./p-5dec669d.js";import{l as a,p as e,s as r,a as n,o,q as l,r as p,b as d,i as c}from"./p-556b5a22.js";const g=class{constructor(s){t(this,s),this.data=[],this.width=300,this.height=300,this.arcMargin=0,this.cornerRadius=0,this.innerRadius=50,this.outerRadius=100,this.transitionDuration=300,this.svg=null,this.radius=null,this.arcs=[],this.prevArcs=[],this.dataSortFn=(t,s)=>s.value-t.value,this.arcMarginScale=a().domain([0,100]).range([0,.2]).clamp(!0),this.cornerRadiusScale=a().domain([0,100]).range([0,50]).clamp(!0),this.innerRadiusScale=a().domain([0,100]).range([0,1]).clamp(!0),this.outerRadiusScale=a().domain([0,100]).range([0,1]).clamp(!0),this.pieGenerator=e().padAngle(this.arcMarginScale(this.arcMargin||0)).sort(this.dataSortFn).value(t=>t.value)}setDataHandler(t){"string"==typeof this.data&&(this.data=this.formatData(t))}formatData(t){let s=t;if("string"==typeof t)try{s=JSON.parse(t)}catch(i){s=[],console.warn("Could not process data",i.message)}return s}componentWillUpdate(){this.prevArcs=[...this.arcs]}componentDidUpdate(){this.rebuildChartDefs(),this.drawChart()}componentWillLoad(){"string"==typeof this.data&&(this.data=this.formatData(this.data))}componentDidLoad(){this.initChartRoot(),this.rebuildChartDefs(),this.drawChart()}initChartRoot(){if(!this.hostEl)return;const t=this.hostEl.querySelector("svg");!this.svg&&t&&(this.svg=r(t),this.svg.append("g").attr("class","donut-image-group").attr("transform",`translate(${(this.width||300)/2},${(this.height||300)/2})`))}rebuildChartDefs(){this.radius=Math.min(this.width||300,this.height||300)/2,this.arcDef=n().outerRadius(this.radius*this.outerRadiusScale(Math.max(this.outerRadius,this.innerRadius)+1)).innerRadius(this.radius*(this.innerRadiusScale(Math.min(this.outerRadius,this.innerRadius)-1)+this.arcMarginScale(this.arcMargin||0)/2)).cornerRadius(this.cornerRadiusScale(this.cornerRadius||0)).padAngle(this.arcMarginScale(this.arcMargin||0)),this.data&&"string"!=typeof this.data&&this.data.length&&(this.colourScale=o().domain(this.data.sort(this.dataSortFn).map(t=>t.name)).range(this.data.length>h.length?(t=>l(p(h),t).reverse())(this.data.length).reverse():h),this.arcs=this.pieGenerator(this.data))}drawChart(){this.svg&&this.arcDef&&this.svg.select("g").attr("transform",`translate(${(this.width||300)/2},${(this.height||300)/2})`).selectAll("path").data(this.arcs,t=>t).join(t=>t.append("path").call(t=>t.transition().duration(this.transitionDuration).ease(d).attr("role","presentation").attr("shape-rendering","auto").attr("fill",t=>t.data.colour||t.data.color||this.colourScale(t.data.name)).attrTween("d",t=>{const s=this.prevArcs.filter(s=>s.data.name===t.data.name)[0]||t,i=c(s.startAngle,t.startAngle),h=c(s.endAngle,t.endAngle);return s=>(t.startAngle=i(s),t.endAngle=h(s),this.arcDef(t)||"")})).append("text").append("tspan").data(this.arcs,t=>t).text(t=>t.data.name),t=>t.call(t=>t.transition().duration(this.transitionDuration||350).ease(d).attr("fill",t=>t.data.colour||t.data.color||this.colourScale(t.data.name)).attrTween("d",t=>{const s=this.prevArcs.filter(s=>s.data.name===t.data.name)[0]||t,i=c(s.startAngle,t.startAngle),h=c(s.endAngle,t.endAngle);return s=>(t.startAngle=i(s),t.endAngle=h(s),this.arcDef(t)||"")})),t=>t.call(t=>t.remove()))}render(){return s("div",{class:"donut-container",style:{minWidth:`${this.width||300}px`}},s("div",{class:"donut-image-container"},s("svg",{class:`svg-content${this.data&&this.data.length?"":" no-data"}`,width:this.width||300,height:this.height,xmlns:"http://www.w3.org/2000/svg",viewBox:`0 0 ${this.width||300} ${this.height||300}`,preserveAspectRatio:"xMinYMin meet"})))}get hostEl(){return i(this)}static get watchers(){return{data:["setDataHandler"]}}static get style(){return":host{--epi-donut-background-color:var(--epi2me-background-color,transparent)}.donut-container{-ms-flex-flow:row wrap;flex-flow:row wrap;width:-webkit-min-content;width:-moz-min-content;width:min-content;-ms-flex:0 1 auto;flex:0 1 auto;font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;margin:0 auto}.donut-container,.donut-container .donut-image-container{display:-ms-flexbox;display:flex;-ms-flex-pack:center;justify-content:center}.donut-container .donut-image-container{-ms-flex-line-pack:center;align-content:center;-ms-flex:0 1 auto;flex:0 1 auto;-ms-flex-flow:row wrap;flex-flow:row wrap}.donut-container .donut-image-container .svg-content.no-data{display:none}"}};export{g as epi_donutimage};